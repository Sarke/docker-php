#!/bin/sh
set -e

# Set permissions based on ENV variable (debian only)
if [ -x "$(command -v usermod)" ] ; then
	usermod -u ${PHP_USER_ID} www-data
fi

if [ 0 -ne "${PHP_ENABLE_SWOOLE:-0}" ] ; then
	docker-php-ext-enable swoole
	docker-php-ext-disable xdebug
	docker-php-ext-disable blackfire
	echo "swoole: on"
	echo "xdebug: off"
	echo "blackfire: off"
else
	echo "swoole: off"

	if [ 0 -ne "${PHP_ENABLE_XDEBUG:-0}" ] ; then
		docker-php-ext-enable xdebug
		echo "xdebug: on"
	else
		echo "xdebug: off"
	fi

	if [ 0 -ne "${PHP_ENABLE_BLACKFIRE:-0}" ] ; then
		docker-php-ext-enable blackfire
		echo "blackfire: on"
	else
		echo "blackfire: off"
	fi
fi

# first arg is `-f` or `--some-option`
if [ "${1#-}" != "$1" ]; then
	if [ -x "$(command -v apache2-foreground)" ]; then
		set -- apache2-foreground "$@"
	else
		set -- php "$@"
	fi
fi

exec "$@"
